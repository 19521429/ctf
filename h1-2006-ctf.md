# h1-2006-ctf Writeup
# June 2020
https://hackerone.com/h1-ctf/


# The Competition Begins!
The tweet announces the CTF challenge. Looks like we will need to find a way to process some payments.

![img](images/intro-tweet.PNG)

# Initial Exploring
Reading up on the extended description at https://hackerone.com/h1-ctf/ reveals that the target of this competition are the domains within `*.bountypay.h1ctf.com`. 

Scanning for available subdomains revealed:
- bountypay.h1ctf.com
- app.bountypay.h1ctf.com
- www.bountypay.h1ctf.com
- staff.bountypay.h1ctf.com
- api.bountypay.h1ctf.com
- software.bountypay.h1ctf.com

The description also mentioned that we should keep a look out on the HackerOne twitter for clues. I took another closer look through their feed.

![img](images/detective.jpg)

Right away, this particular retween stood out:
![img](images/retweet.PNG)

Viewing their profile shows:
![img](images/bp-profile.PNG)

I wonder who they are following?

![img](images/following.PNG)

Sandra has a very interesting tweet!
![img](images/first-day.PNG)

Zoom, enhance! Her staff ID is clearly visible in this tweet. `STF:8FJ3KFISL3`. Thanks, Sandra, this should come in handy later. 

Scanning the barcode didn't really seem to reveal anything. Best to move on for now and to look at the sites.

# Beginning the Journey
First things first, https://bountypay.h1ctf.com/.
![img](images/main-site.PNG)

The main site is pretty uneventful, just a splash screen with two external login pages, and some tumbleweeds.

The customer login is hosted on https://app.bountypay.h1ctf.com/, and the staff login is on https://staff.bountypay.h1ctf.com/.

The login pages were sanitized against SQL injection, and there was no way to create a new account. 

Well, maybe we need to explore some more.

![img](images/lets-go-exploring.jpg)

# Fuzz Faster U Fool
Time to do some directory bruteforcing to see if anything is available other than the login pages. Using the perfectly named `ffuf - Fuzz Faster U Fool`, I scanned for directories on the `app` domain.

```
css                     [Status: 301, Size: 194, Words: 7, Lines: 8]
images                  [Status: 301, Size: 194, Words: 7, Lines: 8]
js                      [Status: 301, Size: 194, Words: 7, Lines: 8] 
logout                  [Status: 302, Size: 0, Words: 1, Lines: 1] 
.                       [Status: 301, Size: 194, Words: 7, Lines: 8]                  
.git                    [Status: 403, Size: 170, Words: 5, Lines: 7] 
cgit                    [Status: 403, Size: 170, Words: 5, Lines: 7]
```

That `.git` is very interesting. Trying to `GET` it returned a 403, but what about it's contents? 

I tried going to `/.git/config` in my browser, and it started downloading.

![img](images/squirtle.PNG)

# Finding a Way In

Let's see what we are dealing with:
```
[core]
	repositoryformatversion = 0
	filemode = true
	bare = false
	logallrefupdates = true
[remote "origin"]
	url = https://github.com/bounty-pay-code/request-logger.git
	fetch = +refs/heads/*:refs/remotes/origin/*
[branch "master"]
	remote = origin
	merge = refs/heads/master
```

The GitHub account has one repository with one file in it, `logger.php`.

```php
<?php

$data = array(
  'IP'        =>  $_SERVER["REMOTE_ADDR"],
  'URI'       =>  $_SERVER["REQUEST_URI"],
  'METHOD'    =>  $_SERVER["REQUEST_METHOD"],
  'PARAMS'    =>  array(
      'GET'   =>  $_GET,
      'POST'  =>  $_POST
  )
);

file_put_contents('bp_web_trace.log', date("U").':'.base64_encode(json_encode($data))."\n",FILE_APPEND   );
```

Looks like they are logging their site activity to `bp_web_trace.log`. Let's see if we can grab that file off of `app`.

```
1588931909:eyJJUCI6IjE5Mi4xNjguMS4xIiwiVVJJIjoiXC8iLCJNRVRIT0QiOiJHRVQiLCJQQVJBTVMiOnsiR0VUIjpbXSwiUE9TVCI6W119fQ==
1588931919:eyJJUCI6IjE5Mi4xNjguMS4xIiwiVVJJIjoiXC8iLCJNRVRIT0QiOiJQT1NUIiwiUEFSQU1TIjp7IkdFVCI6W10sIlBPU1QiOnsidXNlcm5hbWUiOiJicmlhbi5vbGl2ZXIiLCJwYXNzd29yZCI6IlY3aDBpbnpYIn19fQ==
1588931928:eyJJUCI6IjE5Mi4xNjguMS4xIiwiVVJJIjoiXC8iLCJNRVRIT0QiOiJQT1NUIiwiUEFSQU1TIjp7IkdFVCI6W10sIlBPU1QiOnsidXNlcm5hbWUiOiJicmlhbi5vbGl2ZXIiLCJwYXNzd29yZCI6IlY3aDBpbnpYIiwiY2hhbGxlbmdlX2Fuc3dlciI6ImJEODNKazI3ZFEifX19
1588931945:eyJJUCI6IjE5Mi4xNjguMS4xIiwiVVJJIjoiXC9zdGF0ZW1lbnRzIiwiTUVUSE9EIjoiR0VUIiwiUEFSQU1TIjp7IkdFVCI6eyJtb250aCI6IjA0IiwieWVhciI6IjIwMjAifSwiUE9TVCI6W119fQ==
```

Decoding the base 64 entries shows:
```
{"IP":"192.168.1.1","URI":"\/","METHOD":"GET","PARAMS":{"GET":[],"POST":[]}}
{"IP":"192.168.1.1","URI":"\/","METHOD":"POST","PARAMS":{"GET":[],"POST":{"username":"brian.oliver","password":"V7h0inzX"}}}
{"IP":"192.168.1.1","URI":"\/","METHOD":"POST","PARAMS":{"GET":[],"POST":{"username":"brian.oliver","password":"V7h0inzX","challenge_answer":"bD83Jk27dQ"}}}
{"IP":"192.168.1.1","URI":"\/statements","METHOD":"GET","PARAMS":{"GET":{"month":"04","year":"2020"},"POST":[]}}
```

Great, we've got our username and password. Let's login to `app`.

# Trying the Door
